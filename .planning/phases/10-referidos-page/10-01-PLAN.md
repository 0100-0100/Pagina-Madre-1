---
phase: 10-referidos-page
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - ___/accounts/views.py
  - ___/accounts/urls.py
  - ___/templates/referidos.html
autonomous: true

must_haves:
  truths:
    - "User with referrals sees table listing each referred user's nombre, cedula, telefono, and registration date"
    - "User with zero referrals sees friendly empty state message (not empty table or error)"
  artifacts:
    - path: "___/accounts/views.py"
      provides: "referidos_view function"
      contains: "def referidos_view"
    - path: "___/templates/referidos.html"
      provides: "Referidos page template"
      min_lines: 40
  key_links:
    - from: "___/accounts/views.py"
      to: "request.user.referrals"
      via: "reverse ForeignKey relation"
      pattern: "request\\.user\\.referrals\\.all\\(\\)"
    - from: "___/accounts/urls.py"
      to: "referidos_view"
      via: "URL routing"
      pattern: "path\\('referidos/', referidos_view"
---

<objective>
Implement the Referidos page showing users referred by the current user.

Purpose: Complete the referral tracking system by allowing users to see who they have referred.
Output: Working /referidos/ page with table display and empty state handling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-referidos-page/10-RESEARCH.md
@___/accounts/views.py
@___/accounts/urls.py
@___/templates/profile.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create referidos_view and update URL routing</name>
  <files>___/accounts/views.py, ___/accounts/urls.py</files>
  <action>
In accounts/views.py, add a new view function `referidos_view`:
- Use `@login_required` decorator
- Query `request.user.referrals.all().order_by('-date_joined')` to get referred users
- Return render with 'referidos.html' template passing 'referrals' context

In accounts/urls.py:
- Add `referidos_view` to the imports from `.views`
- Change the existing `path('referidos/', placeholder_view, name='referidos')` to use `referidos_view` instead of `placeholder_view`

Pattern follows existing profile_view and home view patterns in the codebase.
  </action>
  <verify>
Run: `python ___/manage.py check` - no errors
Grep: `grep -n "referidos_view" ___/accounts/views.py ___/accounts/urls.py` shows both files
  </verify>
  <done>
- referidos_view function exists with @login_required decorator
- URL route /referidos/ points to referidos_view
- Django check passes with no errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create referidos.html template with table and empty state</name>
  <files>___/templates/referidos.html</files>
  <action>
Create referidos.html template:

1. Extend base.html, set title "Mis Referidos - Pagina Madre"

2. Copy navbar block from profile.html, but set "Referidos" link as active (not "Perfil")

3. In content block, use Bootstrap container with card:
   - If referrals exist: show responsive table with columns Nombre, Cedula, Telefono, Fecha de registro
   - Table classes: `table table-striped table-hover`
   - Wrap table in `<div class="table-responsive">`
   - Table header: `<thead class="table-light">`
   - For each referral: show nombre_completo, cedula, phone, date_joined|date:"d/m/Y"

4. Empty state (when no referrals):
   - Centered card with Bootstrap Icon `bi-people` (large, muted)
   - Heading "Aun no tienes referidos"
   - Subtext "Comparte tu enlace de referido para empezar"
   - Button linking to home page "Ir al inicio"

Use {% if referrals %} around the table, {% else %} for empty state, so empty table with headers is never shown.

Match styling patterns from existing profile.html and home.html templates.
  </action>
  <verify>
Run dev server: `cd ___/ && python manage.py runserver`
Test with referrals: Login as user with referrals, visit /referidos/, verify table displays
Test empty state: Login as user with no referrals, visit /referidos/, verify empty state message shows
  </verify>
  <done>
- Template renders table when user has referrals (shows nombre, cedula, telefono, fecha)
- Template renders friendly empty state when user has no referrals
- Navbar shows Referidos as active link
- Page is styled consistently with profile.html
  </done>
</task>

</tasks>

<verification>
1. Navigate to /referidos/ as logged-in user with referrals
   - Expected: Table with columns Nombre, Cedula, Telefono, Fecha de registro
   - Each referred user appears as a row

2. Navigate to /referidos/ as logged-in user with zero referrals
   - Expected: Empty state card with icon, message, and link to home

3. Navigate to /referidos/ as anonymous user
   - Expected: Redirect to login page

4. Django checks pass: `python ___/manage.py check`
</verification>

<success_criteria>
- REFR-01 satisfied: Table displays Nombre, Cedula, Telefono, Fecha de registro columns
- REFR-02 satisfied: Empty state shows friendly message when user has no referrals
- Page requires authentication (login_required)
- Styling consistent with existing pages (navbar, Bootstrap cards)
</success_criteria>

<output>
After completion, create `.planning/phases/10-referidos-page/10-01-SUMMARY.md`
</output>
