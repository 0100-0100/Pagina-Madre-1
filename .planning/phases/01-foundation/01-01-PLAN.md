---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - requirements.txt
  - .gitignore
  - .env
  - .env.example
  - ___/___/settings.py
autonomous: true

must_haves:
  truths:
    - "Developer can run Django development server without errors"
    - "SECRET_KEY is loaded from .env file, not hardcoded in settings.py"
    - "Git repository excludes sensitive files (.env, db.sqlite3, __pycache__, .venv)"
    - "SQLite database is configured and migrations run successfully"
  artifacts:
    - path: "requirements.txt"
      provides: "Correct Django version and python-decouple"
      contains: "Django"
    - path: ".gitignore"
      provides: "Python/Django exclusions"
      min_lines: 20
    - path: ".env"
      provides: "Environment variables for local development"
      contains: "SECRET_KEY"
    - path: ".env.example"
      provides: "Template for other developers"
      contains: "SECRET_KEY"
    - path: "___/___/settings.py"
      provides: "Environment-based SECRET_KEY configuration"
      pattern: "config\\(.*SECRET_KEY"
  key_links:
    - from: "___/___/settings.py"
      to: ".env"
      via: "python-decouple config()"
      pattern: "from decouple import config"
    - from: "requirements.txt"
      to: ".venv/"
      via: "pip install"
      pattern: "Django"
---

<objective>
Configure project infrastructure for secure development.

Purpose: Establish foundational configuration management and version control hygiene before implementing authentication features. Without proper environment configuration and dependency management, the project cannot be safely developed or deployed.

Output: Working Django project with environment-based secrets, correct dependencies, and proper git exclusions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/codebase/STACK.md
@.planning/codebase/STRUCTURE.md
@.planning/codebase/CONCERNS.md

@requirements.txt
@___/___/settings.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix requirements.txt and add python-decouple</name>
  <files>requirements.txt</files>
  <action>
Update requirements.txt to specify a Django version that exists. Django 6.0.1 does not exist (latest is 5.x). Based on settings.py comments showing Django 4.2.20 was used to generate the project, use Django 4.2 LTS for stability.

Add python-decouple for environment variable management (NOT django-environ - python-decouple is simpler and sufficient for this use case).

Replace content with:
```
Django>=4.2,<5.0
python-decouple>=3.8
```

After writing the file, install dependencies:
```bash
source /Users/Diego.Lopezruiz/Documents/Repositories/Pagina-Madre-1/.venv/bin/activate && pip install -r /Users/Diego.Lopezruiz/Documents/Repositories/Pagina-Madre-1/requirements.txt
```
  </action>
  <verify>pip list | grep -E "Django|python-decouple"</verify>
  <done>requirements.txt contains Django 4.2 and python-decouple, both installed in .venv</done>
</task>

<task type="auto">
  <name>Task 2: Create .gitignore and environment files</name>
  <files>.gitignore, .env, .env.example</files>
  <action>
Create comprehensive .gitignore for Python/Django project covering:
- Python bytecode (*.pyc, __pycache__/)
- Virtual environment (.venv/, venv/, env/)
- Django specific (db.sqlite3, *.log, media/)
- Environment files (.env, .env.local)
- IDE files (.vscode/, .idea/, *.swp)
- OS files (.DS_Store, Thumbs.db)

Create .env file with SECRET_KEY from current settings.py:
```
SECRET_KEY=django-insecure-11y-n1y+svs74+jzo7v47lgl(ml#_r=v(3%b8i!b4%vmr^aq-2
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
```

Create .env.example as template for other developers:
```
SECRET_KEY=your-secret-key-here
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
```

The .env file will be excluded by .gitignore (sensitive), while .env.example is committed (template).
  </action>
  <verify>ls -la /Users/Diego.Lopezruiz/Documents/Repositories/Pagina-Madre-1/ | grep -E "\.env|\.gitignore" && git check-ignore .env db.sqlite3 __pycache__</verify>
  <done>.gitignore exists with Python/Django patterns, .env contains SECRET_KEY, .env.example committed as template</done>
</task>

<task type="auto">
  <name>Task 3: Update settings.py to use environment variables</name>
  <files>___/___/settings.py</files>
  <action>
Modify settings.py to load SECRET_KEY, DEBUG, and ALLOWED_HOSTS from environment using python-decouple.

At the top of the file (after imports), add:
```python
from decouple import config, Csv
```

Replace hardcoded values:
- Line 23: `SECRET_KEY = config('SECRET_KEY')`
- Line 26: `DEBUG = config('DEBUG', default=False, cast=bool)`
- Line 28: `ALLOWED_HOSTS = config('ALLOWED_HOSTS', default='', cast=Csv())`

Keep everything else unchanged. SQLite configuration (lines 76-81) is correct for development.

After modifying, run initial migrations:
```bash
cd /Users/Diego.Lopezruiz/Documents/Repositories/Pagina-Madre-1/___ && python manage.py migrate
```

Then test server startup:
```bash
cd /Users/Diego.Lopezruiz/Documents/Repositories/Pagina-Madre-1/___ && timeout 5 python manage.py runserver || true
```
  </action>
  <verify>grep "from decouple import config" /Users/Diego.Lopezruiz/Documents/Repositories/Pagina-Madre-1/___/___/settings.py && python /Users/Diego.Lopezruiz/Documents/Repositories/Pagina-Madre-1/___/manage.py check</verify>
  <done>settings.py uses config() for SECRET_KEY, DEBUG, ALLOWED_HOSTS; migrations complete; django check passes</done>
</task>

</tasks>

<verification>
After all tasks complete, verify infrastructure is ready:

1. Django server starts without errors: `cd ___ && python manage.py runserver` (test startup, kill after confirmation)
2. Environment variables loaded correctly: `python manage.py check --deploy` shows SECRET_KEY warnings resolved
3. Git properly excludes files: `git status` does not show .env, db.sqlite3, or __pycache__/
4. Database works: `ls ___/db.sqlite3` exists after migrations
</verification>

<success_criteria>
- [ ] requirements.txt specifies Django 4.2 and python-decouple
- [ ] .gitignore excludes .env, db.sqlite3, __pycache__, .venv
- [ ] .env file exists with SECRET_KEY (not committed)
- [ ] .env.example exists as template (committed)
- [ ] settings.py uses config() for SECRET_KEY, DEBUG, ALLOWED_HOSTS
- [ ] Django migrations run successfully
- [ ] `python manage.py runserver` starts without errors
- [ ] All INFRA requirements (INFRA-01, INFRA-02, INFRA-03) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md` following summary.md template.
</output>
