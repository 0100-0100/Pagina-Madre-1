---
phase: 05-styled-auth-pages
plan: 02
type: execute
wave: 2
depends_on: ["01"]
files_modified:
  - ___/accounts/forms.py
  - ___/templates/registration/register.html
autonomous: false

must_haves:
  truths:
    - "User can see registration form in centered Bootstrap card"
    - "All registration fields display with Bootstrap styling"
    - "Data policy checkbox uses Bootstrap structure with required validation"
    - "Form validation errors show for all fields with Bootstrap styling"
    - "Registration button is full-width Bootstrap primary button"
  artifacts:
    - path: "___/accounts/forms.py"
      provides: "CustomUserCreationForm with Bootstrap widget classes for all fields"
      contains: "def __init__"
      min_lines: 40
    - path: "___/templates/registration/register.html"
      provides: "Bootstrap-styled registration template with card layout and manual field rendering"
      contains: "card shadow"
      min_lines: 100
  key_links:
    - from: "___/templates/registration/register.html"
      to: "___/accounts/forms.py"
      via: "form field rendering with Bootstrap classes"
      pattern: "form-control"
    - from: "___/accounts/forms.py"
      to: "Django UserCreationForm"
      via: "__init__ override for password field styling"
      pattern: "password1.*widget.*attrs.*update"
    - from: "___/templates/registration/register.html"
      to: "Bootstrap validation"
      via: "is-invalid and invalid-feedback classes"
      pattern: "(is-invalid|invalid-feedback)"
---

<objective>
Transform the registration page from basic form rendering to a professional Bootstrap 5 interface with centered card layout, styled form fields for all registration inputs, checkbox structure, and comprehensive validation feedback.

Purpose: Provide a polished registration experience with clear validation guidance
Output: Updated CustomUserCreationForm with Bootstrap widget classes and fully styled register.html template with manual field rendering
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/research/PITFALLS.md
@.planning/phases/04-bootstrap-foundation/04-01-SUMMARY.md

# Current forms.py implementation
@___/accounts/forms.py

# Current register template
@___/templates/registration/register.html

# Base template with Bootstrap
@___/templates/base.html
</context>

<tasks>

<task type="auto">
  <name>Update CustomUserCreationForm with Bootstrap widget classes</name>
  <files>___/accounts/forms.py</files>
  <action>
Update the existing CustomUserCreationForm to add Bootstrap classes to all form widgets:

1. Add Meta.widgets dictionary for direct field control:
   ```python
   widgets = {
       'nombre_completo': forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Nombre completo'}),
       'cedula': forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Número de cédula'}),
       'phone': forms.TextInput(attrs={'class': 'form-control', 'placeholder': 'Número de teléfono'}),
       'data_policy_accepted': forms.CheckboxInput(attrs={'class': 'form-check-input'}),
   }
   ```

2. Add Meta.labels dictionary for Spanish labels:
   ```python
   labels = {
       'nombre_completo': 'Nombre Completo',
       'cedula': 'Cédula',
       'phone': 'Teléfono',
       'data_policy_accepted': 'Acepto la política de datos',
   }
   ```

3. Add __init__ method to style inherited password fields:
   ```python
   def __init__(self, *args, **kwargs):
       super().__init__(*args, **kwargs)
       self.fields['password1'].widget.attrs.update({
           'class': 'form-control',
           'placeholder': 'Contraseña'
       })
       self.fields['password2'].widget.attrs.update({
           'class': 'form-control',
           'placeholder': 'Confirmar contraseña'
       })
       self.fields['password1'].label = 'Contraseña'
       self.fields['password2'].label = 'Confirmar Contraseña'
   ```

WHY __init__ for passwords: UserCreationForm's password1 and password2 are inherited fields defined at class level. Meta.widgets doesn't affect inherited fields - must override in __init__ (see PITFALLS.md #1).

WHY CheckboxInput for data_policy_accepted: Template will handle the form-check wrapper structure manually (Meta.widgets only sets the input element class).

Preserve existing clean_data_policy_accepted and save methods - do NOT modify validation logic.
  </action>
  <verify>
```bash
# Verify __init__ method exists with password styling
grep -A 10 "def __init__" ___/accounts/forms.py | grep "password1.*form-control"

# Verify Meta.widgets exists
grep -A 5 "widgets = {" ___/accounts/forms.py | grep "form-control"

# Verify Meta.labels exists
grep -A 5 "labels = {" ___/accounts/forms.py | grep "Nombre Completo"
```
  </verify>
  <done>
CustomUserCreationForm has Meta.widgets with form-control classes for all direct fields, Meta.labels with Spanish translations, and __init__ method that adds form-control to password1 and password2 widgets.
  </done>
</task>

<task type="auto">
  <name>Style registration template with Bootstrap card and manual field rendering</name>
  <files>___/templates/registration/register.html</files>
  <action>
Replace the current {{ form.as_p }} rendering with complete Bootstrap 5 styled template:

**Layout structure (same as login):**
- Centered layout: min-vh-100, d-flex, align-items-center, justify-content-center
- Container > row > col-md-6 col-lg-5
- Card with shadow class

**Form structure (inside card-body):**
1. Card header with h4 "Crear Cuenta"

2. Django messages as Bootstrap alerts (if messages exist):
   - Loop through messages
   - Use alert-danger for error, alert-success for success
   - Include alert-dismissible with close button

3. Manual field rendering for each field with proper error handling:

   For each field (cedula, nombre_completo, phone, password1, password2):
   ```html
   <div class="mb-3">
       <label for="{{ form.FIELD.id_for_label }}" class="form-label">{{ form.FIELD.label }}</label>
       <input type="text|password"
              name="{{ form.FIELD.name }}"
              class="form-control {% if form.FIELD.errors %}is-invalid{% endif %}"
              id="{{ form.FIELD.id_for_label }}"
              value="{{ form.FIELD.value|default:'' }}"
              {% if form.FIELD.field.required %}required{% endif %}>
       {% if form.FIELD.errors %}
           <div class="invalid-feedback">
               {{ form.FIELD.errors.0 }}
           </div>
       {% endif %}
   </div>
   ```

4. Data policy checkbox (special structure):
   ```html
   <div class="form-check mb-3">
       <input type="checkbox"
              class="form-check-input {% if form.data_policy_accepted.errors %}is-invalid{% endif %}"
              id="{{ form.data_policy_accepted.id_for_label }}"
              name="data_policy_accepted"
              required>
       <label class="form-check-label" for="{{ form.data_policy_accepted.id_for_label }}">
           Acepto la <a href="#">política de datos</a>
       </label>
       {% if form.data_policy_accepted.errors %}
           <div class="invalid-feedback d-block">
               {{ form.data_policy_accepted.errors.0 }}
           </div>
       {% endif %}
   </div>
   ```

5. Submit button: btn btn-primary w-100 mb-3

6. Login link: "¿Ya tienes cuenta? Inicia sesión aquí"

**Field order:** cedula, nombre_completo, phone, password1, password2, data_policy_accepted

**Critical CSRF placement:** {% csrf_token %} must be first inside <form> tag.

WHY manual rendering: Need to apply is-invalid class conditionally, control exact Bootstrap structure, and handle checkbox wrapper properly (see PITFALLS.md #2).

WHY d-block on checkbox invalid-feedback: Without d-block, feedback div doesn't display for checkboxes (Bootstrap quirk).

AVOID: Don't use {{ form.as_p }} or auto-rendering - loses Bootstrap structure and error class control.
  </action>
  <verify>
```bash
# Check for Bootstrap card structure
grep "card shadow" ___/templates/registration/register.html

# Check for manual field rendering (not form.as_p)
! grep "form.as_p" ___/templates/registration/register.html

# Check for form-control on inputs
grep -c "form-control" ___/templates/registration/register.html
# Should return at least 5 (cedula, nombre, phone, password1, password2)

# Check for checkbox structure
grep "form-check-input" ___/templates/registration/register.html

# Check for conditional is-invalid classes
grep "is-invalid" ___/templates/registration/register.html

# Verify CSRF token is first in form
grep -A 1 "<form" ___/templates/registration/register.html | grep csrf_token
```
  </verify>
  <done>
Registration template contains: card with shadow, manual rendering of all 6 fields, form-control on text/password inputs, form-check wrapper for checkbox with d-block on invalid-feedback, conditional is-invalid classes, btn-primary for submit, centered responsive layout, and CSRF token correctly placed.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Bootstrap-styled registration page with centered card, all form fields manually rendered with Bootstrap styling, checkbox structure, and comprehensive validation feedback</what-built>
  <how-to-verify>
1. Start development server (if not running):
   ```bash
   cd /Users/Diego.Lopezruiz/Documents/Repositories/Pagina-Madre-1/___
   python manage.py runserver
   ```

2. Open registration page in browser:
   - URL: http://127.0.0.1:8000/accounts/register/
   - Expected: Centered card with "Crear Cuenta" header

3. Visual checks:
   - [ ] Form displays in centered Bootstrap card with shadow
   - [ ] All 5 text fields (Cédula, Nombre Completo, Teléfono, Contraseña, Confirmar Contraseña) have styled inputs
   - [ ] Data policy checkbox aligned properly with clickable label and link
   - [ ] "Register" button is full-width blue Bootstrap primary button
   - [ ] "Login here" link visible at bottom

4. Test validation feedback:
   - Submit completely empty form
   - Expected: All required fields show red borders and error messages below each field
   - Verify errors appear for: cedula, nombre_completo, phone, password1, password2, data_policy_accepted

5. Test password validation:
   - Fill all fields but use weak password (e.g., "123")
   - Expected: Password field shows specific Django validation error in red text

6. Test password mismatch:
   - Fill all fields with different passwords in password1/password2
   - Expected: Password confirmation field shows "passwords don't match" error

7. Test checkbox validation:
   - Fill all fields correctly but don't check data policy
   - Expected: Checkbox shows error message "You must accept the data policy"

8. Test mobile responsiveness:
   - Open browser DevTools (F12)
   - Toggle device toolbar
   - Select iPhone 12 Pro (390px width)
   - Expected: Card fills screen, all fields stack vertically, no horizontal scroll

9. Test successful registration:
   - Fill all fields correctly:
     - Cédula: [new unique number, e.g., 9988776655]
     - Nombre: Test User
     - Teléfono: 3001234567
     - Contraseña: ComplexPass123!
     - Confirmar: ComplexPass123!
     - Check data policy box
   - Expected: Account created, redirect to login or home page

10. Test duplicate cedula:
    - Try registering with existing cedula
    - Expected: Error message shows with Bootstrap alert styling
  </how-to-verify>
  <resume-signal>
Type "approved" if registration page looks professional and all validation scenarios work correctly, or describe any issues found.
  </resume-signal>
</task>

</tasks>

<verification>
## Overall Phase Checks

After checkpoint approval:

1. **Visual verification:**
   - Registration page renders with Bootstrap card styling
   - All 6 form fields have consistent spacing and styling
   - Checkbox structure matches Bootstrap documentation
   - Validation errors display clearly in red below each field

2. **Code verification:**
   ```bash
   # CustomUserCreationForm has __init__ method
   grep "def __init__" ___/accounts/forms.py

   # Template has manual field rendering (not form.as_p)
   ! grep "form.as_p" ___/templates/registration/register.html

   # Template has Bootstrap structure for all fields
   grep -c "form-control" ___/templates/registration/register.html
   # Should return at least 5
   ```

3. **Requirements coverage:**
   - R9: Registration form in centered card ✓
   - R10: All fields have form-control class ✓
   - R11: Data policy checkbox uses form-check with required ✓
   - R12: Submit button is full-width primary ✓
   - R13: Validation feedback for all fields ✓
   - R17: Django messages as Bootstrap alerts ✓
   - R18: Widget classes applied in forms.py __init__ ✓
</verification>

<success_criteria>
1. CustomUserCreationForm has Meta.widgets with Bootstrap classes for direct fields
2. CustomUserCreationForm has __init__ method adding Bootstrap classes to password1/password2
3. CustomUserCreationForm has Spanish labels for all fields
4. Registration template renders with centered Bootstrap card
5. All 5 text/password fields display with form-control styling
6. Data policy checkbox uses proper Bootstrap form-check structure with d-block on invalid-feedback
7. Form validation errors show with Bootstrap is-invalid and invalid-feedback classes
8. Django messages render as Bootstrap alerts
9. Submit button is full-width Bootstrap primary button
10. Page works correctly on mobile viewport (375px width)
11. User can successfully register with valid data
12. Invalid submissions show styled error feedback for all affected fields
13. Password validation, mismatch, and policy acceptance all work with styled errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-styled-auth-pages/05-02-SUMMARY.md`

Document:
- CustomUserCreationForm changes (Meta.widgets, __init__ method)
- Bootstrap classes applied to each field
- Template structure changes (card, manual field rendering)
- Validation feedback implementation
- Any deviations or issues encountered
- Screenshots or visual verification notes (optional)
</output>
