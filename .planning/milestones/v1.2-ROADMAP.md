# Milestone v1.2: Referrals

**Status:** SHIPPED 2026-01-19
**Phases:** 7-10
**Total Plans:** 5

## Overview

Add referral tracking system to the authentication portal. Users get unique referral codes, can share links to recruit others, track progress toward goals, manage their profile, and view their referral list. Four phases: model foundation with registration capture, home page referral UI, profile management, and referidos table.

## Phases

### Phase 7: Referral Model & Registration

**Goal:** Users can register via referral links and the system tracks referrer relationships.
**Depends on:** None (extends existing CustomUser model)
**Plans:** 2 plans

Plans:
- [x] 07-01-PLAN.md — Add referral fields to CustomUser model with migrations
- [x] 07-02-PLAN.md — Modify registration view to capture referral codes

**Requirements:**
- REF-01: CustomUser has unique 8-char alphanumeric referral_code field (auto-generated)
- REF-02: CustomUser has referred_by ForeignKey to self (on_delete=SET_NULL)
- REF-03: CustomUser has referral_goal PositiveIntegerField (default=10)
- REF-04: Existing users receive referral codes via data migration
- REG-01: Registration URL accepts `?ref=CODE` parameter
- REG-02: Valid referral code sets referred_by on new user
- REG-03: Invalid or missing referral code proceeds without error

---

### Phase 8: Home Page Referral UI

**Goal:** Users can see their referral progress and share their unique link from the home page.
**Depends on:** Phase 7 (referral_code, referred_by fields exist)
**Plans:** 1 plan

Plans:
- [x] 08-01-PLAN.md — Update home page with referral stats, copy button, and navigation links

**Requirements:**
- HOME-01: Home page displays total referral count
- HOME-02: Home page displays progress toward goal ("X de Y referidos")
- HOME-03: Home page shows shareable referral link
- HOME-04: Home page has navigation links to Perfil and Referidos pages

---

### Phase 9: Profile Page

**Goal:** Users can manage their account details and set their referral goal.
**Depends on:** Phase 7 (referral_goal field exists), Phase 8 (navigation link exists)
**Plans:** 1 plan

Plans:
- [x] 09-01-PLAN.md — Profile editing page and password change page

**Requirements:**
- PROF-01: Profile page allows editing nombre_completo
- PROF-02: Profile page allows editing telefono
- PROF-03: Profile page allows changing password
- PROF-04: Profile page allows setting/updating referral goal

---

### Phase 10: Referidos Page

**Goal:** Users can view details of everyone they have referred.
**Depends on:** Phase 7 (referred_by relationship), Phase 8 (navigation link exists)
**Plans:** 1 plan

Plans:
- [x] 10-01-PLAN.md — Referidos page with table and empty state

**Requirements:**
- REFR-01: Referidos page displays table with columns: Nombre, Cedula, Telefono, Fecha de registro
- REFR-02: Empty state shows message when user has no referrals

---

## Milestone Summary

**Key Decisions:**

- Three-step migration for unique fields (add nullable, populate, add constraint) — SQLite safe
- Self-referential ForeignKey with SET_NULL preserves user when referrer deleted
- filter().first() for graceful referral lookup (no exception on invalid codes)
- Django PasswordChangeView extension for secure password handling
- navigator.clipboard API for modern clipboard access
- Bootstrap Icons 1.13.1 for navigation icons

**Issues Resolved:**

- SQLite unique constraint migration handled via SeparateDatabaseAndState
- Circular import avoided with local import in register view

**Issues Deferred:**

- None

**Technical Debt Incurred:**

- None (placeholder_view cleaned up before milestone completion)

---

*For current project status, see .planning/ROADMAP.md (created for next milestone)*

---
*Archived: 2026-01-19 as part of v1.2 milestone completion*
